{"version":3,"file":"index.js","sources":["src/lib/is-ignored.js","src/lib/get-custom-properties-from-root.js","src/lib/get-custom-properties-from-imports.js","src/lib/transform-value-ast.js","src/lib/transform-properties.js","src/lib/write-custom-properties-to-exports.js","src/index.js"],"sourcesContent":["function isBlockIgnored(ruleOrDeclaration) {\r\n\tvar rule = ruleOrDeclaration.selector ?\r\n\t\truleOrDeclaration : ruleOrDeclaration.parent;\r\n\r\n\treturn /(!\\s*)?postcss-custom-properties:\\s*off\\b/i.test(rule.toString())\r\n}\r\n\r\nfunction isRuleIgnored(rule) {\r\n\tvar previous = rule.prev();\r\n\r\n\treturn Boolean(isBlockIgnored(rule) ||\r\n\t\tprevious &&\r\n\t\tprevious.type === 'comment' &&\r\n\t\t/(!\\s*)?postcss-custom-properties:\\s*ignore\\s+next\\b/i.test(previous.text));\r\n}\r\n\r\nexport {\r\n\tisBlockIgnored,\r\n\tisRuleIgnored\r\n}\r\n","import { parse } from 'postcss-values-parser';\r\nimport { isBlockIgnored } from './is-ignored';\r\n\r\n// return custom selectors from the css root, conditionally removing them\r\nexport default function getCustomPropertiesFromRoot(root, opts) {\r\n\t// initialize custom selectors\r\n\tconst customPropertiesFromHtmlElement = {};\r\n\tconst customPropertiesFromRootPseudo = {};\r\n\r\n\t// for each html or :root rule\r\n\troot.nodes.slice().forEach(rule => {\r\n\t\tconst customPropertiesObject = isHtmlRule(rule)\r\n\t\t\t? customPropertiesFromHtmlElement\r\n\t\t: isRootRule(rule)\r\n\t\t\t? customPropertiesFromRootPseudo\r\n\t\t: null;\r\n\r\n\t\t// for each custom property\r\n\t\tif (customPropertiesObject) {\r\n\t\t\trule.nodes.slice().forEach(decl => {\r\n\t\t\t\tif (isCustomDecl(decl) && !isBlockIgnored(decl)) {\r\n\t\t\t\t\tconst { prop } = decl;\r\n\r\n\t\t\t\t\t// write the parsed value to the custom property\r\n\t\t\t\t\tcustomPropertiesObject[prop] = parse(decl.value).nodes;\r\n\r\n\t\t\t\t\t// conditionally remove the custom property declaration\r\n\t\t\t\t\tif (!opts.preserve) {\r\n\t\t\t\t\t\tdecl.remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// conditionally remove the empty html or :root rule\r\n\t\t\tif (!opts.preserve && isEmptyParent(rule) && !isBlockIgnored(rule)) {\r\n\t\t\t\trule.remove();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t// return all custom properties, preferring :root properties over html properties\r\n\treturn { ...customPropertiesFromHtmlElement, ...customPropertiesFromRootPseudo };\r\n}\r\n\r\n// match html and :root rules\r\nconst htmlSelectorRegExp = /^html$/i;\r\nconst rootSelectorRegExp = /^:root$/i;\r\nconst customPropertyRegExp = /^--[A-z][\\w-]*$/;\r\n\r\n// whether the node is an html or :root rule\r\nconst isHtmlRule = node => node.type === 'rule' && htmlSelectorRegExp.test(node.selector) && Object(node.nodes).length;\r\nconst isRootRule = node => node.type === 'rule' && rootSelectorRegExp.test(node.selector) && Object(node.nodes).length;\r\n\r\n// whether the node is an custom property\r\nconst isCustomDecl = node => node.type === 'decl' && customPropertyRegExp.test(node.prop);\r\n\r\n// whether the node is a parent without children\r\nconst isEmptyParent = node => Object(node.nodes).length === 0;\r\n","import fs from 'fs';\r\nimport path from 'path';\r\nimport postcss from 'postcss';\r\nimport { parse } from 'postcss-values-parser';\r\nimport getCustomPropertiesFromRoot from './get-custom-properties-from-root';\r\n\r\n/* Get Custom Properties from CSS File\r\n/* ========================================================================== */\r\n\r\nasync function getCustomPropertiesFromCSSFile(from) {\r\n\tconst css = await readFile(from);\r\n\tconst root = postcss.parse(css, { from });\r\n\r\n\treturn getCustomPropertiesFromRoot(root, { preserve: true });\r\n}\r\n\r\n/* Get Custom Properties from Object\r\n/* ========================================================================== */\r\n\r\nfunction getCustomPropertiesFromObject(object) {\r\n\tconst customProperties = Object.assign(\r\n\t\t{},\r\n\t\tObject(object).customProperties,\r\n\t\tObject(object)['custom-properties']\r\n\t);\r\n\r\n\tfor (const key in customProperties) {\r\n\t\tcustomProperties[key] = parse(String(customProperties[key])).nodes;\r\n\t}\r\n\r\n\treturn customProperties;\r\n}\r\n\r\n/* Get Custom Properties from JSON file\r\n/* ========================================================================== */\r\n\r\nasync function getCustomPropertiesFromJSONFile(from) {\r\n\tconst object = await readJSON(from);\r\n\r\n\treturn getCustomPropertiesFromObject(object);\r\n}\r\n\r\n/* Get Custom Properties from JS file\r\n/* ========================================================================== */\r\n\r\nasync function getCustomPropertiesFromJSFile(from) {\r\n\tconst object = await import(from);\r\n\r\n\treturn getCustomPropertiesFromObject(object);\r\n}\r\n\r\n/* Get Custom Properties from Imports\r\n/* ========================================================================== */\r\n\r\nexport default function getCustomPropertiesFromImports(sources) {\r\n\treturn sources.map(source => {\r\n\t\tif (source instanceof Promise) {\r\n\t\t\treturn source;\r\n\t\t} else if (source instanceof Function) {\r\n\t\t\treturn source();\r\n\t\t}\r\n\r\n\t\t// read the source as an object\r\n\t\tconst opts = source === Object(source) ? source : { from: String(source) };\r\n\r\n\t\t// skip objects with Custom Properties\r\n\t\tif (opts.customProperties || opts['custom-properties']) {\r\n\t\t\treturn opts\r\n\t\t}\r\n\r\n\t\t// source pathname\r\n\t\tconst from = path.resolve(String(opts.from || ''));\r\n\r\n\t\t// type of file being read from\r\n\t\tconst type = (opts.type || path.extname(from).slice(1)).toLowerCase();\r\n\r\n\t\treturn { type, from };\r\n\t}).reduce(async (customProperties, source) => {\r\n\t\tconst { type, from } = await source;\r\n\r\n\t\tif (type === 'css') {\r\n\t\t\treturn Object.assign(await customProperties, await getCustomPropertiesFromCSSFile(from));\r\n\t\t}\r\n\r\n\t\tif (type === 'js') {\r\n\t\t\treturn Object.assign(await customProperties, await getCustomPropertiesFromJSFile(from));\r\n\t\t}\r\n\r\n\t\tif (type === 'json') {\r\n\t\t\treturn Object.assign(await customProperties, await getCustomPropertiesFromJSONFile(from));\r\n\t\t}\r\n\r\n\t\treturn Object.assign(await customProperties, await getCustomPropertiesFromObject(await source));\r\n\t}, {});\r\n}\r\n\r\n/* Helper utilities\r\n/* ========================================================================== */\r\n\r\nconst readFile = from => new Promise((resolve, reject) => {\r\n\tfs.readFile(from, 'utf8', (error, result) => {\r\n\t\tif (error) {\r\n\t\t\treject(error);\r\n\t\t} else {\r\n\t\t\tresolve(result);\r\n\t\t}\r\n\t});\r\n});\r\n\r\nconst readJSON = async from => JSON.parse(await readFile(from));\r\n","export default function transformValueAST(root, customProperties) {\r\n\tif (root.nodes && root.nodes.length) {\r\n\t\troot.nodes.slice().forEach(child => {\r\n\t\t\tif (isVarFunction(child)) {\r\n\t\t\t\t// eslint-disable-next-line no-unused-vars\r\n\t\t\t\tconst [propertyNode, comma, ...fallbacks] = child.nodes;\r\n\t\t\t\tconst { value: name } = propertyNode;\r\n\r\n\t\t\t\tif (name in customProperties) {\r\n\t\t\t\t\t// conditionally replace a known custom property\r\n\t\t\t\t\tconst nodes = asClonedArrayWithBeforeSpacing(customProperties[name], child.raws.before);\r\n\r\n\t\t\t\t\tchild.replaceWith(...nodes);\r\n\r\n\t\t\t\t\tretransformValueAST({ nodes }, customProperties, name);\r\n\t\t\t\t} else if (fallbacks.length) {\r\n\t\t\t\t\t// conditionally replace a custom property with a fallback\r\n\t\t\t\t\tconst index = root.nodes.indexOf(child);\r\n\r\n\t\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\t\troot.nodes.splice(index, 1, ...asClonedArrayWithBeforeSpacing(fallbacks, child.raws.before));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttransformValueAST(root, customProperties);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\ttransformValueAST(child, customProperties);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\treturn root;\r\n}\r\n\r\n// retransform the current ast without a custom property (to prevent recursion)\r\nfunction retransformValueAST(root, customProperties, withoutProperty) {\r\n\tconst nextCustomProperties = Object.assign({}, customProperties);\r\n\r\n\tdelete nextCustomProperties[withoutProperty];\r\n\r\n\treturn transformValueAST(root, nextCustomProperties);\r\n}\r\n\r\n// match var() functions\r\nconst varRegExp = /^var$/i;\r\n\r\n// whether the node is a var() function\r\nconst isVarFunction = node => node.type === 'func' && varRegExp.test(node.name) && Object(node.nodes).length > 0;\r\n\r\n// return an array with its nodes cloned, preserving the raw\r\nconst asClonedArrayWithBeforeSpacing = (array, beforeSpacing) => {\r\n\tconst clonedArray = asClonedArray(array, null);\r\n\r\n\tif (clonedArray[0]) {\r\n\t\tclonedArray[0].raws.before = beforeSpacing;\r\n\t}\r\n\r\n\treturn clonedArray;\r\n};\r\n\r\n// return an array with its nodes cloned\r\nconst asClonedArray = (array, parent) => array.map(node => asClonedNode(node, parent));\r\n\r\n// return a cloned node\r\nconst asClonedNode = (node, parent) => {\r\n\tconst cloneNode = new node.constructor(node);\r\n\r\n\tfor (const key in node) {\r\n\t\tif (key === 'parent') {\r\n\t\t\tcloneNode.parent = parent;\r\n\t\t} else if (Object(node[key]).constructor === Array) {\r\n\t\t\tcloneNode[key] = asClonedArray(node.nodes, cloneNode);\r\n\t\t} else if (Object(node[key]).constructor === Object) {\r\n\t\t\tcloneNode[key] = Object.assign({}, node[key]);\r\n\t\t}\r\n\t}\r\n\r\n\treturn cloneNode;\r\n};\r\n","import { parse } from 'postcss-values-parser';\r\nimport transformValueAST from './transform-value-ast';\r\nimport { isRuleIgnored } from './is-ignored';\r\n\r\n// transform custom pseudo selectors with custom selectors\r\nexport default (root, customProperties, opts) => {\r\n\t// walk decls that can be transformed\r\n\troot.walkDecls(decl => {\r\n\t\tif (isTransformableDecl(decl) && !isRuleIgnored(decl)) {\r\n\t\t\tconst originalValue = decl.value;\r\n\t\t\tconst valueAST = parse(originalValue);\r\n\t\t\tconst value = String(transformValueAST(valueAST, customProperties));\r\n\r\n\t\t\t// conditionally transform values that have changed\r\n\t\t\tif (value !== originalValue) {\r\n\t\t\t\tif (opts.preserve) {\r\n\t\t\t\t\tdecl.cloneBefore({ value });\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdecl.value = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n};\r\n\r\n// match custom properties\r\nconst customPropertyRegExp = /^--[A-z][\\w-]*$/;\r\n\r\n// match custom property inclusions\r\nconst customPropertiesRegExp = /(^|[^\\w-])var\\([\\W\\w]+\\)/;\r\n\r\n// whether the declaration should be potentially transformed\r\nconst isTransformableDecl = decl => !customPropertyRegExp.test(decl.prop) && customPropertiesRegExp.test(decl.value);\r\n","import fs from 'fs';\r\nimport path from 'path';\r\n\r\n/* Write Custom Properties to CSS File\r\n/* ========================================================================== */\r\n\r\nasync function writeCustomPropertiesToCssFile(to, customProperties) {\r\n\tconst cssContent = Object.keys(customProperties).reduce((cssLines, name) => {\r\n\t\tcssLines.push(`\\t${name}: ${customProperties[name]};`);\r\n\r\n\t\treturn cssLines;\r\n\t}, []).join('\\n');\r\n\tconst css = `:root {\\n${cssContent}\\n}\\n`;\r\n\r\n\tawait writeFile(to, css);\r\n}\r\n\r\n/* Write Custom Properties to JSON file\r\n/* ========================================================================== */\r\n\r\nasync function writeCustomPropertiesToJsonFile(to, customProperties) {\r\n\tconst jsonContent = JSON.stringify({\r\n\t\t'custom-properties': customProperties\r\n\t}, null, '  ');\r\n\tconst json = `${jsonContent}\\n`;\r\n\r\n\tawait writeFile(to, json);\r\n}\r\n\r\n/* Write Custom Properties to Common JS file\r\n/* ========================================================================== */\r\n\r\nasync function writeCustomPropertiesToCjsFile(to, customProperties) {\r\n\tconst jsContents = Object.keys(customProperties).reduce((jsLines, name) => {\r\n\t\tjsLines.push(`\\t\\t'${escapeForJS(name)}': '${escapeForJS(customProperties[name])}'`);\r\n\r\n\t\treturn jsLines;\r\n\t}, []).join(',\\n');\r\n\tconst js = `module.exports = {\\n\\tcustomProperties: {\\n${jsContents}\\n\\t}\\n};\\n`;\r\n\r\n\tawait writeFile(to, js);\r\n}\r\n\r\n/* Write Custom Properties to Module JS file\r\n/* ========================================================================== */\r\n\r\nasync function writeCustomPropertiesToMjsFile(to, customProperties) {\r\n\tconst mjsContents = Object.keys(customProperties).reduce((mjsLines, name) => {\r\n\t\tmjsLines.push(`\\t'${escapeForJS(name)}': '${escapeForJS(customProperties[name])}'`);\r\n\r\n\t\treturn mjsLines;\r\n\t}, []).join(',\\n');\r\n\tconst mjs = `export const customProperties = {\\n${mjsContents}\\n};\\n`;\r\n\r\n\tawait writeFile(to, mjs);\r\n}\r\n\r\n/* Write Custom Properties to Exports\r\n/* ========================================================================== */\r\n\r\nexport default function writeCustomPropertiesToExports(customProperties, destinations) {\r\n\treturn Promise.all(destinations.map(async destination => {\r\n\t\tif (destination instanceof Function) {\r\n\t\t\tawait destination(defaultCustomPropertiesToJSON(customProperties));\r\n\t\t} else {\r\n\t\t\t// read the destination as an object\r\n\t\t\tconst opts = destination === Object(destination) ? destination : { to: String(destination) };\r\n\r\n\t\t\t// transformer for Custom Properties into a JSON-compatible object\r\n\t\t\tconst toJSON = opts.toJSON || defaultCustomPropertiesToJSON;\r\n\r\n\t\t\tif ('customProperties' in opts) {\r\n\t\t\t\t// write directly to an object as customProperties\r\n\t\t\t\topts.customProperties = toJSON(customProperties);\r\n\t\t\t} else if ('custom-properties' in opts) {\r\n\t\t\t\t// write directly to an object as custom-properties\r\n\t\t\t\topts['custom-properties'] = toJSON(customProperties);\r\n\t\t\t} else {\r\n\t\t\t\t// destination pathname\r\n\t\t\t\tconst to = String(opts.to || '');\r\n\r\n\t\t\t\t// type of file being written to\r\n\t\t\t\tconst type = (opts.type || path.extname(opts.to).slice(1)).toLowerCase();\r\n\r\n\t\t\t\t// transformed Custom Properties\r\n\t\t\t\tconst customPropertiesJSON = toJSON(customProperties);\r\n\r\n\t\t\t\tif (type === 'css') {\r\n\t\t\t\t\tawait writeCustomPropertiesToCssFile(to, customPropertiesJSON);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (type === 'js') {\r\n\t\t\t\t\tawait writeCustomPropertiesToCjsFile(to, customPropertiesJSON);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (type === 'json') {\r\n\t\t\t\t\tawait writeCustomPropertiesToJsonFile(to, customPropertiesJSON);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (type === 'mjs') {\r\n\t\t\t\t\tawait writeCustomPropertiesToMjsFile(to, customPropertiesJSON);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}));\r\n}\r\n\r\n/* Helper utilities\r\n/* ========================================================================== */\r\n\r\nconst defaultCustomPropertiesToJSON = customProperties => {\r\n\treturn Object.keys(customProperties).reduce((customPropertiesJSON, key) => {\r\n\t\tcustomPropertiesJSON[key] = String(customProperties[key]);\r\n\r\n\t\treturn customPropertiesJSON;\r\n\t}, {});\r\n};\r\n\r\nconst writeFile = (to, text) => new Promise((resolve, reject) => {\r\n\tfs.writeFile(to, text, error => {\r\n\t\tif (error) {\r\n\t\t\treject(error);\r\n\t\t} else {\r\n\t\t\tresolve();\r\n\t\t}\r\n\t});\r\n});\r\n\r\nconst escapeForJS = string => string.replace(/\\\\([\\s\\S])|(')/g, '\\\\$1$2').replace(/\\n/g, '\\\\n').replace(/\\r/g, '\\\\r');\r\n","import postcss from 'postcss';\r\nimport getCustomPropertiesFromRoot from './lib/get-custom-properties-from-root';\r\nimport getCustomPropertiesFromImports from './lib/get-custom-properties-from-imports';\r\nimport transformProperties from './lib/transform-properties';\r\nimport writeCustomPropertiesToExports from './lib/write-custom-properties-to-exports';\r\n\r\nexport default postcss.plugin('postcss-custom-properties', opts => {\r\n\t// whether to preserve custom selectors and rules using them\r\n\tconst preserve = 'preserve' in Object(opts) ? Boolean(opts.preserve) : true;\r\n\r\n\t// sources to import custom selectors from\r\n\tconst importFrom = [].concat(Object(opts).importFrom || []);\r\n\r\n\t// destinations to export custom selectors to\r\n\tconst exportTo = [].concat(Object(opts).exportTo || []);\r\n\r\n\t// promise any custom selectors are imported\r\n\tconst customPropertiesPromise = getCustomPropertiesFromImports(importFrom);\r\n\r\n\t// make sure we work in synchronous mode if no asynchronous operations are requested\r\n\tif(importFrom.length === 0 && exportTo.length === 0) {\r\n\t\treturn root => {\r\n\t\t\tconst customProperties = getCustomPropertiesFromRoot(root, { preserve });\r\n\t\t\ttransformProperties(root, customProperties, { preserve });\r\n\t\t}\r\n\t}\r\n\r\n\treturn async root => {\r\n\t\tconst customProperties = Object.assign(\r\n\t\t\tawait customPropertiesPromise,\r\n\t\t\tgetCustomPropertiesFromRoot(root, { preserve })\r\n\t\t);\r\n\r\n\t\tawait writeCustomPropertiesToExports(customProperties, exportTo);\r\n\r\n\t\ttransformProperties(root, customProperties, { preserve });\r\n\t};\r\n});\r\n"],"names":["isBlockIgnored","ruleOrDeclaration","rule","selector","parent","test","toString","isRuleIgnored","previous","prev","Boolean","type","text","getCustomPropertiesFromRoot","root","opts","customPropertiesFromHtmlElement","customPropertiesFromRootPseudo","nodes","slice","forEach","customPropertiesObject","isHtmlRule","isRootRule","decl","isCustomDecl","prop","parse","value","preserve","remove","isEmptyParent","htmlSelectorRegExp","rootSelectorRegExp","customPropertyRegExp","node","Object","length","getCustomPropertiesFromCSSFile","from","css","readFile","postcss","getCustomPropertiesFromObject","object","customProperties","assign","key","String","getCustomPropertiesFromJSONFile","readJSON","getCustomPropertiesFromJSFile","getCustomPropertiesFromImports","sources","map","source","Promise","Function","path","resolve","extname","toLowerCase","reduce","reject","fs","error","result","JSON","transformValueAST","child","isVarFunction","propertyNode","comma","fallbacks","name","asClonedArrayWithBeforeSpacing","raws","before","replaceWith","retransformValueAST","index","indexOf","splice","withoutProperty","nextCustomProperties","varRegExp","array","beforeSpacing","clonedArray","asClonedArray","asClonedNode","cloneNode","constructor","Array","walkDecls","isTransformableDecl","originalValue","valueAST","cloneBefore","customPropertiesRegExp","writeCustomPropertiesToCssFile","to","cssContent","keys","cssLines","push","join","writeFile","writeCustomPropertiesToJsonFile","jsonContent","stringify","json","writeCustomPropertiesToCjsFile","jsContents","jsLines","escapeForJS","js","writeCustomPropertiesToMjsFile","mjsContents","mjsLines","mjs","writeCustomPropertiesToExports","destinations","all","destination","defaultCustomPropertiesToJSON","toJSON","customPropertiesJSON","string","replace","plugin","importFrom","concat","exportTo","customPropertiesPromise","transformProperties"],"mappings":"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"}